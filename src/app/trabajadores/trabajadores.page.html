<ion-header [translucent]="true"> 
  <ion-toolbar>
    <ion-grid>
      <ion-row>
        <ion-col>
          <ion-toolbar>
            <ion-searchbar 
              [(ngModel)]="rutBusqueda" 
              (ionInput)="buscarPorRut()"
              placeholder="Buscar por RUT"
              class="busquedaRUT">
            </ion-searchbar>
          </ion-toolbar>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>

  <div class="container" style="background-color: #2D3250; padding: 5px; display: flex; justify-content: space-between; align-items: center;">
    <ion-title class="ion-padding">Lista de empleados</ion-title>
    <ion-button *ngIf="isAdmin" class="botonAgregar" id="open-modal-agregar" expand="block" (click)="resetFormulario()" style="margin-left: auto;">
      Agregar trabajador
    </ion-button>
  </div>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Modal para agregar trabajador -->
  <ion-modal #modalAgregar trigger="open-modal-agregar">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Agregar trabajador</ion-title>
          <ion-buttons slot="end">
            <ion-button color="light" (click)="modalAgregar.dismiss()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <ion-item>
          <ion-label position="floating">Email</ion-label>
          <ion-input type="email" [(ngModel)]="trabajador.email"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Contraseña</ion-label>
          <ion-input type="password" [(ngModel)]="trabajador.contrasena"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Rut</ion-label>
          <ion-input type="text" [(ngModel)]="trabajador.rut_empleado" placeholder="Ingrese su rut sin puntos y con guión"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Nombre</ion-label>
          <ion-input type="text" [(ngModel)]="trabajador.nombre"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Apellidos</ion-label>
          <ion-input type="text" [(ngModel)]="trabajador.apellido"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Teléfono</ion-label>
          <ion-input type="number" [(ngModel)]="trabajador.telefono"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Cargo</ion-label>
          <ion-select [(ngModel)]="trabajador.cargo">
            <ion-select-option value="conserje">Conserje</ion-select-option>
            <ion-select-option value="aseo">Aseo</ion-select-option>
            <ion-select-option value="administrador">Administrador</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Foto</ion-label>
          <input type="file" (change)="onImageSelected($event)" accept="image/*" />
        </ion-item>
      </ion-content>

      <ion-footer>
        <ion-button expand="block" (click)="agregarTrabajador()">Agregar trabajador</ion-button>
      </ion-footer>
    </ng-template>
  </ion-modal>

  <!-- Lista de trabajadores en tarjetas -->
  <ion-grid>
    <ion-row>
      <ion-col size="12" size-md="6" *ngFor="let trabajador of listaDeTrabajadores">
        <ion-card>
          <ion-item>
            <ion-thumbnail slot="start">
              <img *ngIf="trabajador.fotoUrl" [src]="trabajador.fotoUrl" alt="Foto de trabajador" />
              <ion-icon *ngIf="!trabajador.fotoUrl" name="person-circle-outline"></ion-icon>
            </ion-thumbnail>
            <ion-label>
              <h2>{{ trabajador.nombre }} {{ trabajador.apellido }}</h2>
              <p>Cargo: {{ trabajador.cargo }}</p>
              <p>Email: {{ trabajador.email }}</p>
              <p>Rut: {{ trabajador.rut_empleado }}</p>
            </ion-label>
          </ion-item>
          <ion-item lines="none">
            <!-- Editar trabajador -->
            <ion-button *ngIf="isAdmin" fill="outline" color="primary" (click)="cargarTrabajadorParaEditar(trabajador); modalEditar.present()">
              Editar
            </ion-button>

            <!-- Eliminar trabajador -->
            <ion-button *ngIf="isAdmin && trabajador.id" fill="outline" color="danger" (click)="confirmarEliminarTrabajador(trabajador.id!, trabajador.fotoUrl!)">
              Eliminar
            </ion-button>
          </ion-item>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <!-- Modal para editar trabajador -->
  <ion-modal #modalEditar>
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Editar trabajador</ion-title>
          <ion-buttons slot="end">
            <ion-button color="light" (click)="modalEditar.dismiss()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <ion-item>
          <ion-label position="floating">Email</ion-label>
          <ion-input type="email" [(ngModel)]="trabajador.email"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Contraseña</ion-label>
          <ion-input type="password" [(ngModel)]="trabajador.contrasena"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Rut</ion-label>
          <ion-input type="text" [(ngModel)]="trabajador.rut_empleado" placeholder="Ingrese su rut sin puntos y con guión" ></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Nombre</ion-label>
          <ion-input type="text" [(ngModel)]="trabajador.nombre"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Apellidos</ion-label>
          <ion-input type="text" [(ngModel)]="trabajador.apellido"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Teléfono</ion-label>
          <ion-input type="number" [(ngModel)]="trabajador.telefono"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="floating">Cargo</ion-label>
          <ion-select [(ngModel)]="trabajador.cargo">
            <ion-select-option value="conserje">Conserje</ion-select-option>
            <ion-select-option value="aseo">Aseo</ion-select-option>
            <ion-select-option value="administrador">Administrador</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Cambiar Foto</ion-label>
          <input type="file" (change)="onEditImageSelected($event)" accept="image/*"/>
        </ion-item>
      </ion-content>

      <ion-footer>
        <ion-button expand="block" (click)="confirmarEditarTrabajador()">Guardar cambios</ion-button>
      </ion-footer>
    </ng-template>
  </ion-modal>
</ion-content>
